<script>
  async function loadGamesCombined() {
    const container = document.getElementById("live-espn-games");
    if (!container) return;

    container.innerHTML = "Loading games...";

    const sources = [
      {
        league: "NBA",
        url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS75MzF61eZ1loPVTa56TvlfU2Z5ZXUiQuIL-nQ8XVlJYIzrHEzAoVstru5wwlEaTuZSlRd4XrwEXZM/pub?gid=529321486&single=true&output=csv"
      },
      {
        league: "MLB",
        url: "https://docs.google.com/spreadsheets/d/e/2PACX-1vS75MzF61eZ1loPVTa56TvlfU2Z5ZXUiQuIL-nQ8XVlJYIzrHEzAoVstru5wwlEaTuZSlRd4XrwEXZM/pub?gid=355225860&single=true&output=csv"
      }
    ];

    try {
      let allLines = [];

      for (const { league, url } of sources) {
        const res = await fetch(url);
        const text = await res.text();
        const rows = text.trim().split("\n").map(row => row.split(","));
        const games = rows.slice(1).filter(row => row.length >= 7);

        if (games.length > 0) {
          const lines = games.map(row => {
            const [sport, leagueName, matchup, status, score, startTime, streamInfo] = row;
            const displayScore = (status.includes("Live") || status.includes("Final")) ? score : startTime;
            const statusColor = status.includes("Live") ? "lime" : status.includes("Final") ? "#aaa" : "#ccc";

            return `
              <div style="margin-bottom: 8px;">
                <div style="color: #bbb; font-weight: bold;">${leagueName}</div>
                <div>${matchup}</div>
                <div style="color: ${statusColor}; font-size: 10px;">${status} â€” ${displayScore}</div>
              </div>
            `;
          });

          allLines.push(...lines);
        }
      }

      container.innerHTML = allLines.length ? allLines.join("") : "<div style='padding: 10px;'>No games today.</div>";

    } catch (err) {
      console.error("Failed to load games:", err);
      container.innerHTML = "<div style='padding: 10px;'>Error loading games.</div>";
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadGamesCombined();
    setInterval(loadGamesCombined, 5 * 60 * 1000); // Refresh every 5 minutes

    const container = document.getElementById("standings-Home");
    document.querySelectorAll("#menuList li[data-section]").forEach(item => {
      item.addEventListener("click", () => {
        const section = item.dataset.section;
        if (container) {
          container.style.display = section === "Home" ? "block" : "none";
        }
      });
    });
  });
</script>
