<script>
  // 1) URL of your published "LeaguesPriority" sheet
  const leagueOrderURL = 
    'https://docs.google.com/spreadsheets/d/e/2PACX-1vS75MzF61eZ1loPVTa56TvlfU2Z5ZXUiQuIL-nQ8XVlJYIzrHEzAoVstru5wwlEaTuZSlRd4XrwEXZM/pub?gid=0&single=true&output=csv';

  // 2) CSV URLs for each league tab you’ve already published
  const sheetURLs = {
    NFL:            'https://docs.google.com/spreadsheets/d/e/2PACX-1vS75MzF61eZ1loPVTa56TvlfU2Z5ZXUiQuIL-nQ8XVlJYIzrHEzAoVstru5wwlEaTuZSlRd4XrwEXZM/pub?gid=1646106823&single=true&output=csv',
    NHL:            'https://docs.google.com/spreadsheets/d/e/2PACX-1vS75MzF61eZ1loPVTa56TvlfU2Z5ZXUiQuIL-nQ8XVlJYIzrHEzAoVstru5wwlEaTuZSlRd4XrwEXZM/pub?gid=905422182&single=true&output=csv',
    NBA:            'https://docs.google.com/spreadsheets/d/e/2PACX-1vS75MzF61eZ1loPVTa56TvlfU2Z5ZXUiQuIL-nQ8XVlJYIzrHEzAoVstru5wwlEaTuZSlRd4XrwEXZM/pub?gid=529321486&single=true&output=csv',
    MLB:            'https://docs.google.com/spreadsheets/d/e/2PACX-1vS75MzF61eZ1loPVTa56TvlfU2Z5ZXUiQuIL-nQ8XVlJYIzrHEzAoVstru5wwlEaTuZSlRd4XrwEXZM/pub?gid=355225860&single=true&output=csv',
    WNBA:           'https://docs.google.com/spreadsheets/d/e/2PACX-1vS75MzF61eZ1loPVTa56TvlfU2Z5ZXUiQuIL-nQ8XVlJYIzrHEzAoVstru5wwlEaTuZSlRd4XrwEXZM/pub?gid=1033631487&single=true&output=csv',
    NCAABaseball:   'https://docs.google.com/spreadsheets/d/e/2PACX-1vS75MzF61eZ1loPVTa56TvlfU2Z5ZXUiQuIL-nQ8XVlJYIzrHEzAoVstru5wwlEaTuZSlRd4XrwEXZM/pub?gid=748675011&single=true&output=csv',
    NCAASoftball:   'https://docs.google.com/spreadsheets/d/e/2PACX-1vS75MzF61eZ1loPVTa56TvlfU2Z5ZXUiQuIL-nQ8XVlJYIzrHEzAoVstru5wwlEaTuZSlRd4XrwEXZM/pub?gid=1365095373&single=true&output=csv'
  };  // ← only one closing here

  let leagueOrder = [];

  // 1️⃣ Load the league order
  async function loadLeagueOrder() {
    try {
      const res  = await fetch(leagueOrderURL);
      const text = await res.text();
      leagueOrder = text.trim().split('\n').map(r => r.split(',')[0]);
    } catch {
      console.error('Failed to load league order');
      leagueOrder = Object.keys(sheetURLs);
    }
  }

  // 2️⃣ Fetch each league’s CSV
  async function fetchAllGames() {
    const byLeague = {};
    await Promise.all(Object.entries(sheetURLs).map(async ([league, url]) => {
      try {
        const res  = await fetch(url);
        const text = await res.text();
        const rows = text.trim().split('\n').slice(1).map(r => r.split(','));
        if (rows.length) byLeague[league] = rows;
      } catch (e) {
        console.warn(`Error loading ${league}`, e);
      }
    }));
    return byLeague;
  }

  // 3️⃣ Render, updating only each league’s list
  function renderGames(byLeague) {
    const container = document.getElementById('live-games-container');
    // clear the “Loading…” on first run
    if (container.childElementCount === 0) container.innerHTML = '';

    leagueOrder.forEach(league => {
      const games = byLeague[league] || [];
      let leagueDiv = container.querySelector(`[data-league="${league}"]`);
      if (!leagueDiv) {
        leagueDiv = document.createElement('div');
        leagueDiv.setAttribute('data-league', league);
        leagueDiv.style.marginBottom = '12px';
        leagueDiv.innerHTML = `
          <div style="color:#bbb;font-weight:bold;margin-bottom:4px;">${league}</div>
          <div class="games-list"></div>
        `;
        container.appendChild(leagueDiv);
      }
      const list = leagueDiv.querySelector('.games-list');
      list.innerHTML = '';

      if (games.length === 0) {
        const no = document.createElement('div');
        no.textContent = 'No games today.';
        no.style.color = '#666';
        list.appendChild(no);
        return;
      }

      games.forEach(cols => {
        let [, , matchup, status, score, startTime] = cols;
        let [a,b] = matchup.split(' vs. ');
        a = a.split(' ').pop();
        b = b.split(' ').pop();
        const displayScore = /Live|Final/.test(status)
          ? score
          : new Date(startTime).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
        const color = /Live/.test(status)   ? 'lime'
                    : /Final/.test(status)  ? '#aaa'
                    :                        '#ccc';

        const div = document.createElement('div');
        div.style.marginBottom = '6px';
        div.innerHTML = `
          <span>${a} vs. ${b}</span><br>
          <span style="color:${color};font-size:10px;">
            ${status==='Scheduled' ? '' : status} ${displayScore || ''}
          </span>`;
        list.appendChild(div);
      });
    });
  }

  // 4️⃣ Main loader
  async function loadAndRender() {
    const byLeague = await fetchAllGames();
    renderGames(byLeague);
  }

  document.addEventListener('DOMContentLoaded', async () => {
    // only show on Home
    const homeContainer = document.getElementById('live-games-container');
    document.querySelectorAll('#menuList li[data-section]').forEach(item => {
      item.addEventListener('click', () => {
        homeContainer.closest('.content-section').style.display =
          (item.dataset.section === 'Home') ? 'block' : 'none';
      });
    });

    await loadLeagueOrder();
    await loadAndRender();
    setInterval(loadAndRender, 5 * 60 * 1000);
  });
</script>
